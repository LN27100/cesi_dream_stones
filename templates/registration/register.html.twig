<!DOCTYPE html>
<html lang="fr">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Inscription Dream Stones</title>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer"/>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
		<link href="{{ asset('assets/styles/app.css') }}" rel="stylesheet">

	</head>

	<body>
		<header>
			{% block header %}
				{% include 'includes/header.php' %}
			{% endblock %}
		</header>

		<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
			<div class="offcanvas-header">
				<h5 class="offcanvas-title text-light" id="offcanvasExampleLabel">Votre panier</h5>
				<button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
			</div>
			<!-- PANIER COTE -->
			<div id="cart">
				<div class="product border border-light d-flex" data-id="1">
					<div class="offcanvas-body">
						<div>
							<div class="row">
								<div class="col-md-6">
									<div id="cartItems"></div>
									<p class="text-light">Total : €<span id="cartTotal">0.00</span>
									</p>
								</div>
							</div>
						</div>
						<form id="orderForm" action="{{ path('confirm_order') }}" method="post">
							<input type="hidden" name="action" value="view_order">
							<input type="hidden" name="product_ids" id="productIds">
							<button type="submit" class="btn2">Commander</button>
						</form>
					</div>
				</div>
			</div>
		</div>

		<div class="containerReg">
			{% block content %}
				<div class="card">
					<h1>Formulaire d'inscription</h1>
					<div class="card-body">
						<form id="registration-form" action="{{ path('inscription') }}" method="post">
							{{ form_start(form) }}
							<div class="mb-3 input-group">
								{{ form_row(form.name, {'attr': {'class': 'form-control'}, 'required': true}) }}
								<span class="required-label">*</span>
								<p id="name-error" class="text-danger"></p>
							</div>
							<div class="mb-3 input-group">
								{{ form_row(form.firstname, {'attr': {'class': 'form-control'}, 'required': true}) }}
								<span class="required-label">*</span>
								<p id="firstname-error" class="text-danger"></p>
							</div>
							<div class="mb-3 input-group">
								{{ form_row(form.pseudo, {'attr': {'class': 'form-control', 'autocomplete': 'username'}, 'required': true}) }}
								<span class="required-label">*</span>
								<p id="pseudo-error" class="text-danger"></p>
							</div>
							<div class="input-group">
								{{ form_row(form.email, {'attr': {'class': 'form-control', 'autocomplete': 'email'}, 'required': true}) }}
								<span class="required-label">*</span>
								<p id="email-error" class="text-danger"></p>
							</div>
							<div class="mb-3 input-group">
								{{ form_row(form.password.first, {'attr': {'class': 'form-control', 'autocomplete': 'new-password'}, 'required': true}) }}
								<span class="required-label">*</span>
							</div>
							<p id="password-error" class="text-danger"></p>
							<div class="password-conditions">
								<div class="condition">Au moins 8 caractères</div>
								<div class="condition">Au moins une lettre minuscule</div>
								<div class="condition">Au moins une lettre majuscule</div>
								<div class="condition">Au moins un chiffre</div>
								<div class="condition">Au moins un caractère spécial</div>
							</div>

							<div class="mb-3 input-group">
								{{ form_row(form.password.second, {'attr': {'class': 'form-control', 'autocomplete': 'new-password'}, 'required': true}) }}
								<span class="required-label">*</span>
								<p id="password-confirm-error" class="text-danger"></p>
							</div>
							<div class="mb-3 input-group">
								{{ form_row(form.streetName, {'attr': {'class': 'form-control'}, 'required': true}) }}
								<span class="required-label">*</span>
								<p id="streetName-error" class="text-danger"></p>
							</div>
							<div class="mb-3 input-group">
								{{ form_row(form.additionalAddress, {'attr': {'class': 'form-control'}}) }}
								<p id="additionalAddress-error" class="text-danger"></p>
							</div>
							<div class="mb-3 input-group">
								{{ form_row(form.zipcode, {'attr': {'class': 'form-control'}, 'required': true}) }}
								<span class="required-label">*</span>
								<p id="zipcode-error" class="text-danger"></p>
							</div>
							<div class="mb-3 input-group">
								{{ form_row(form.city, {'attr': {'class': 'form-control'}, 'required': true}) }}
								<span class="required-label">*</span>
								<p id="city-error" class="text-danger"></p>
							</div>
							<div class="mb-3 input-group">
								{{ form_row(form.phone, {'attr': {'class': 'form-control'}, 'required': true}) }}
								<span class="required-label">*</span>
								<p id="phone-error" class="text-danger"></p>
							</div>
							<div class="mb-3 input-group d-flex justify-content-center">
								{{ form_row(form.submit, {'attr': {'class': 'btn2'}}) }}
							</div>
							{{ form_end(form) }}
						</form>
					</div>
				</div>
			{% endblock %}
		</div>


		<footer>
			{% block footer %}
				{% include 'includes/footer.php' %}
			{% endblock %}
		</footer>


		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
		<script src="{{ asset('assets/js/script.js') }}"></script>

<script>
    // Contrôles des champs d'inscription
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('registration-form');

        form.addEventListener('submit', function (event) {
            const requiredInputs = form.querySelectorAll('input[required]');
            let hasError = false;

            requiredInputs.forEach(function (input) {
                if (!input.value.trim()) {
                    const errorElement = document.getElementById(`${input.id}-error`);
                    errorElement.textContent = "Champ obligatoire";
                    hasError = true;
                }
            });

            if (hasError) {
                event.preventDefault();
            }
        });

        // Contrôles du mot de passe
        const passwordField = document.getElementById('registration_password_first');
        const passwordConditions = document.querySelector('.password-conditions');

        // Affiche les conditions de mot de passe lors du clic sur le champ de mot de passe
        passwordField.addEventListener('click', function () {
            passwordConditions.classList.toggle('visible');
        });

        // Vérifie les conditions de mot de passe lors de la saisie
        passwordField.addEventListener('input', function () {
            const password = this.value;
            const hasMinimumLength = password.length >= 8;
            const hasLowerCase = /[a-z]/.test(password);
            const hasUpperCase = /[A-Z]/.test(password);
            const hasNumber = /\d/.test(password);
            const hasSpecialChar = /[!@#$%^&*()_+]/.test(password);

            // Met à jour les classes des conditions de mot de passe quand remplies
            const conditions = passwordConditions.querySelectorAll('.condition');
            conditions[0].classList.toggle('condition-passed', hasMinimumLength);
            conditions[1].classList.toggle('condition-passed', hasLowerCase);
            conditions[2].classList.toggle('condition-passed', hasUpperCase);
            conditions[3].classList.toggle('condition-passed', hasNumber);
            conditions[4].classList.toggle('condition-passed', hasSpecialChar);
        });

        // Validation du champ nom
        const nameField = document.getElementById('registration_name');
        nameField.addEventListener('blur', function () {
            const nameValue = this.value.trim();
            const nameError = document.getElementById('name-error');
            if (!/^[a-zA-Z-]+$/.test(nameValue)) {
                nameError.textContent = "Le nom ne peut contenir que des lettres et des tirets";
            } else {
                nameError.textContent = "";
            }
        });

        // Validation du champ prénom
        const firstnameField = document.getElementById('registration_firstname');
        firstnameField.addEventListener('blur', function () {
            const firstnameValue = this.value.trim();
            const firstnameError = document.getElementById('firstname-error');
            if (!/^[a-zA-Z-]+$/.test(firstnameValue)) {
                firstnameError.textContent = "Le prénom ne peut contenir que des lettres et des tirets";
            } else {
                firstnameError.textContent = "";
            }
        });

        // Validation du champ email
        const emailField = document.getElementById('registration_email');
        emailField.addEventListener('blur', function () {
            const emailValue = this.value.trim();
            const emailError = document.getElementById('email-error');
            if (!emailValue.includes('@')) {
                emailError.textContent = "L'adresse email doit contenir un @";
            } else {
                emailError.textContent = "";
            }
        });

        // Validation du champ téléphone
        const phoneField = document.getElementById('registration_phone');
        phoneField.addEventListener('blur', function () {
            const phoneValue = this.value.trim();
            const phoneError = document.getElementById('phone-error');
            if (!/^\d+$/.test(phoneValue)) {
                phoneError.textContent = "Le numéro de téléphone ne peut contenir que des chiffres";
            } else {
                phoneError.textContent = "";
            }
        });
    });
</script>

	</body>

</html>
